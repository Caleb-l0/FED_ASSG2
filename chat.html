        var chatHistory = {}; // Object to store chat history for each product

        document.getElementById('user-input').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                handleUserInput();
            }
        });

        function handleUserInput() {
            var userInput = document.getElementById('user-input').value;
            if (userInput.trim() !== '') {
                appendMessage('user', userInput);
                var currentProduct = document.getElementById('chat-header').textContent;
                var response = getResponse(currentProduct, userInput);
                appendMessage('bot', response);
            }
            document.getElementById('user-input').value = '';
        }

        function appendMessage(sender, message) {
            var messageElement = document.createElement('div');
            messageElement.classList.add(sender);
            messageElement.textContent = message;
            document.getElementById('chat-messages').appendChild(messageElement);

            // Store the message in the chat history
            var currentProduct = document.getElementById('chat-header').textContent;
            if (!chatHistory[currentProduct]) {
                chatHistory[currentProduct] = [];
            }
            chatHistory[currentProduct].push({ sender: sender, message: message });
        }

        function getResponse(product, input) {
            input = input.toLowerCase();
            var productResponses = responsesDatabase[product];

            if (productResponses) {
                if (productResponses.greetings[input]) {
                    return productResponses.greetings[input];
                } else if (productResponses.seller[input]) {
                    return productResponses.seller[input];
                }
            }
            return productResponses ? productResponses.default : 'Sorry, I didn\'t catch that.';
        }

        function showPopup(product) {
            document.getElementById('popup').style.display = 'block';
            document.getElementById('chat-header').textContent = product;

            // Clear previous messages
            document.getElementById('chat-messages').innerHTML = '';

            // Load the stored messages for the product
            if (chatHistory[product]) {
                chatHistory[product].forEach(function(chat) {
                    appendMessage(chat.sender, chat.message);
                });
            }
        }

        function closePopup() {
            document.getElementById('popup').style.display = 'none';
        }

        // Automatically close the popup when the page first loads
        document.addEventListener('DOMContentLoaded', function() {
            closePopup(); // Close the popup immediately when the page loads
        });

        document.querySelectorAll('.chat-item').forEach(function(item) {
            item.addEventListener('click', function() {
                var product = item.querySelector('span').textContent;
                showPopup(product);
            });
        });

        document.getElementById('close-chat').addEventListener('click', closePopup);
